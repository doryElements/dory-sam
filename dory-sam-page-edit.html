<link rel="import" href="../polymer/polymer.html">



<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-button/paper-button.html">

<link rel="import" href="../air-cruddy/air-cruddy-elasticsearch.html">

<link rel="import" href="dory-sam-editor.html">

<!--
`dory-sam-page-edit`
Polymer Element dory-sam-page-edit

@demo demo/index.html 
-->

<dom-module id="dory-sam-page-edit">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <paper-toolbar class="medium-tall">
            <paper-icon-button id="button" icon="clear" on-tap="_requestList"></paper-icon-button>
            <div class="title">Edit ([[entityId]]) [[data.app]] - [[data.env]]</div>

        </paper-toolbar>

        <div class="card-actions">
            <paper-button on-tap="validate">Validate</paper-button>
            <paper-button on-tap="retrieve">Retrieve</paper-button>
            <paper-button on-tap="save">Save</paper-button>
            <paper-button on-tap="newEntity">New</paper-button>
            <paper-button on-tap="delete">Delete</paper-button>
        </div>

        <air-cruddy-elasticsearch id="cruddy"  mode="cors" url="http://localhost:9200/sam/sam"
                                  elastic-refresh="true"
                                  data="{{data}}" entity-id="{{entityId}}">

            <dory-sam-editor id="editor" data="{{data}}"></dory-sam-editor>
         </air-cruddy-elasticsearch>
    </template>

    <script>
        Polymer({

            is: 'dory-sam-page-edit',

            properties: {
                data: {
                    type: Object
                },
                entityId: {
                    type: String
                },

            },


            initPage: function () {
              console.log('--------------- initPage Lyfecycle ------------------');
            },

            save: function () {
              this.$.cruddy.save();
            },
            retrieve: function () {
              this.$.cruddy.retrieve();
            },
            newEntity: function () {
              this.$.cruddy.newEntity();
            },
            delete: function () {
                this.$.cruddy.delete().then(this._requestList().bind(this));
            },

            validate: function () {
               return  this.$.editor.validate();
            },

            _requestList: function (e) {
                this.fire('dory-open-page', {page:'list'})
            },

        });
    </script>
</dom-module>