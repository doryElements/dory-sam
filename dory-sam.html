<link rel="import" href="../polymer/polymer-element.html">

<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<link rel="import" href="../dory-layout/dory-main-layout/dory-main-layout.html">

<link rel="import" href="dory-editor-layout.html">
<link rel="import" href="dory-sam-editor.html">
<link rel="import" href="dory-sam-list.html">
<link rel="import" href="dory-sam-card-details.html">
<link rel="import" href="dory-cruddy-event.html">

<dom-module id="dory-sam">
    <template>
        <style>
            :host {
                display: block;
            }

            h1{
                color: var(--h1-color);
                font : 40px "Roboto";
                margin-bottom : 5px;
            }

            paper-fab {
                right: 30px;
                bottom: 28px;
                position: fixed;
                --paper-fab-background: var(--primary-color);
            }

            .side{
                color:var(--sidebar-text-color);
                font : 16px Roboto;
                padding : 10px;
                margin-top: 50px;
            }

            .main-content{
                height : calc(100vh - 122px);
            }
        </style>

        <iron-pages selected="[[tabSelected]]" fallback-selection="fallback">

            <!-- LISTE -->
            <dory-main-layout   search
                                url="https://localhost:8181/api/sams/"
                                list-data="{{listData}}"
                                method="get">
                <div slot="top-sidebar">
                    <img src="[[logo]]" alt="Agrica">
                </div>
                <div slot="title">
                    <h1>DORY</h1>
                    Dépendances des applications
                </div>
                <div slot="list">
                    <dory-sam-list id="doryList" items="{{listData}}" entity-id="{{entityId}}"></dory-sam-list>
                    <paper-fab  icon="add-circle-outline" on-tap="_openEditorCreate"></paper-fab>
                </div>
            </dory-main-layout>

            <!-- EDITOR -->
            <dory-editor-layout id="edit">
                <dory-cruddy-event slot="editor">
                    <dory-sam-editor id="doryEditor" entity-id="{{entityId}}"></dory-sam-editor>
                </dory-cruddy-event>
            </dory-editor-layout>

            <!-- DETAILS VIEW -->
            <dory-main-layout>
                <div class="main-content" slot="content">
                    <dory-sam-card-details entity-id="[[entityId]]"></dory-sam-card-details>
                </div>
                <div  slot="sidebar" class="side" on-tap="_close">
                    <iron-icon icon="arrow-back"></iron-icon>
                    <label>Retour à la liste</label>
                </div>
            </dory-main-layout>

        </iron-pages>
    </template>

    <script>
        /**
         * `dory-sam`
         *
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class DorySam extends Polymer.Element {
            static get is() { return 'dory-sam'; }

            ready() {
                super.ready();
                this.listData = new Array();
                this.$.doryList.addEventListener('dory-open-editor', e => this._handleEdit(e));
                this.$.doryList.addEventListener('dory-open-details', e => this._handleDetails(e));
                this.$.edit.addEventListener('editor-close', e => this._close(e));
                this.$.edit.addEventListener('editor-control', e => this.$.doryEditor._handleCommand(e.detail.command));
            }

            static get properties() {
                return {
                    items:{
                        type:Object,
                    },
                    listData:{
                        type:Array,
                        value: () => {
                            return [];
                        }
                    },
                    entityId : {
                        type : String
                    },
                    tabSelected : {
                        type: Number,
                        value : 0
                    },
                    logo: {
                        type:String
                    }
                };
            };

            _handleEdit(e){
                let itemId = e.detail.id;
                this.entityId = itemId;
                this._openEditor();
            }
            _handleDetails(e){
                let itemId = e.detail.id;
                this.entityId = itemId;
                this.tabSelected=2;
            }
            _openEditorCreate(){
                this.entityId = null;
                this._openEditor();
            }
            _openEditor(){
                this.tabSelected = 1;
            }
            _close(){
                this.tabSelected = 0;
            }
        }
        window.customElements.define(DorySam.is, DorySam);
    </script>
</dom-module>
