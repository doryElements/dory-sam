<link rel="import" href="../polymer/polymer-element.html">

<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/device-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<link rel="import" href="dory-d3-relationship-graph.html">

<dom-module id="dory-sam-card-details-tab">
    <template>
        <style>
            :host {
                display: block;
            }

            h3{
                color : var(--h3-color);
            }

            h4{
                color : var(--h4-color);
            }

            .dyn-list{
                display : inline-table;
                width  : 33%;
                min-width : 300px;
            }

            .scheme{
                width : 100%;
            }
        </style>

        <template is="dom-if" if="[[servers]]">
            <div class="dyn-list">
                <h4>Servers</h4>
                <template is="dom-repeat" items="[[data.serveurs]]" as="it">
                    <p>
                        <iron-icon icon="dns" style="--iron-icon-fill-color:#FFE0B2"></iron-icon>
                        <label>[[it]]</label>
                    </p>
                </template>
            </div>
        </template>

        <template is="dom-if" if="[[bdds]]">
            <div class="dyn-list">
                <h4>Bases de données</h4>
                <template is="dom-repeat" items="[[data.bdds]]" as="it">
                    <p><iron-icon icon="device:storage" style="--iron-icon-fill-color:#FF8A65"></iron-icon> [[it]] </p>
                </template>
            </div>
        </template>

        <template is="dom-if" if="[[urls]]">
            <div class="dyn-list">
                <h4>URLs</h4>
                <template is="dom-repeat" items="[[data.urls]]" as="it">
                    <p><iron-icon icon="cloud" style="--iron-icon-fill-color:#B2EBF2"></iron-icon> [[it]] </p>
                </template>
            </div>
        </template>

        <template is="dom-if" if="[[softwares]]">
            <div class="dyn-list">
                <h4>Softwares</h4>
                <template is="dom-repeat" items="[[data.softwares]]" as="it">
                    <p>[[it]]</p>
                </template>
            </div>
        </template>

        <template is="dom-if" if="[[vips]]">
            <div class="dyn-list">
                <h4>VIPs</h4>
                <template is="dom-repeat" items="[[data.vips]]" as="it">
                    <p><iron-icon icon="face" style="--iron-icon-fill-color:#FFE0B2"></iron-icon> [[it]] </p>
                </template>
            </div>
        </template>

        <div class="scheme">
            <h3>Schéma Infrastructure</h3>
            <dory-d3-relationship-graph id ="graph" data="[[graphData]]" width="720" height="480"></dory-d3-relationship-graph>
        </div>

    </template>

    <script>
        /**
         * `dory-sam-card-details-tab`
         *
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class DorySamCardDetailsTab extends Polymer.Element {
            static get is() {
                return 'dory-sam-card-details-tab';
            }

            static get properties() {
                return {
                    app:{
                        type : String,
                        observer : '_setArraysDisplay'
                    },
                    data: {
                        type: Object,
                        observer : '_createGraph'
                    },
                    servers:{
                        type : Boolean,
                        value : false
                    },
                    bdds:{
                        type: Boolean,
                        value : false
                    },
                    vips:{
                        type: Boolean,
                        value : false
                    },
                    softwares:{
                        type: Boolean,
                        value : false
                    },
                    urls:{
                        type: Boolean,
                        value : false
                    },
                    graphData:{
                        type : Object,
                        notify : true
                    }
                };
            }

            /**
             * Set booleans related to arrays to True if the arrays are not empty
             * @private
             */
            _setArraysDisplay(){
                if(this.data){
                    if(this.data.softwares && this.data.softwares.length>0){
                        this.set('softwares',true);
                    }
                    if(this.data.bdds && this.data.bdds.length>0){
                        this.set('bdds',true);
                    }
                    if(this.data.urls && this.data.urls.length>0){
                        this.set('urls',true);
                    }
                    if(this.data.serveurs && this.data.serveurs.length>0){
                        this.set('servers',true);
                    }
                    if(this.data.vips && this.data.vips.length>0){
                        this.set('vips',true);
                    }
                }
            }

            _createGraph(){
                if(this.data){
                    let app = this.app;
                    this.graphData = {};
                    let nodes = [];
                    let links = [];

                    nodes.push({'name':this.app,'color':'#FFCC80','icon':'tab'});

                    if(this.data.serveurs){
                        this.data.serveurs.forEach(function(server){
                            nodes.push({'name':server,'color':'#B0BEC5','icon':'dns'});
                            links.push({'source':app,'target':server});
                        });
                    }

                    if(this.data.bdds){
                        this.data.bdds.forEach(function(bdd){
                            nodes.push({'name':bdd,'color':'#FF7043','icon':'device:storage'});
                            links.push({'source':app,'target':bdd});
                        });
                    }

                    this.graphData.nodes = nodes;
                    this.graphData.links = links;
                    this.$.graph.draw();

                }
            }
        }

        window.customElements.define(DorySamCardDetailsTab.is, DorySamCardDetailsTab);
    </script>
</dom-module>