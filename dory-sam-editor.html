<link rel="import" href="../polymer/polymer.html">


<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../paper-input/paper-textarea.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-tags/paper-tags-input.html">

<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<link rel="import" href="dory-listbox.html">
<link rel="import" href="dory-sam-editor-servers.html">
<link rel="import" href="dory-sam-dyn-list.html">
<link rel="import" href="dory-markdown.html">

<link rel="import" href="../air-cruddy/air-cruddy-elasticsearch.html">
<!--
`dory-sam-list`
Dory Service Application Mapping Form Editor

@demo demo/index.html 
-->

<dom-module id="dory-sam-editor">
    <template>
        <style>
            :host {
                display: block;
                padding: 10px;
                @apply(--layout-vertical);
                @apply(--layout-flex);
                background-color: #ddd;
            }

            .dynbox {
                margin-top: 1em;
                min-width: 600px;
                @apply(--layout-flex-2);
            }
        </style>

        <paper-card heading="Edition de [[entityId]]">
            <div class="card-content">


                <air-cruddy-elasticsearch id="cruddy" data="{{data}}" url="http://localhost:9200/twitter/tweet"
                                            entity-id="1">


                    <form is="iron-form" id="form">

                        <paper-input value="{{data.app}}" required auto-validate
                                     maxlength="20" label="Nom"></paper-input>

                        <div class="layout horizontal wrap flex">
                            <paper-textarea class="flex" char-counter maxlength="1000" rows="3" required
                                            label="Description"
                                            value="{{data.description}}"></paper-textarea>

                            <dory-markdown class="flex" value="[[data.description]]"></dory-markdown>
                        </div>

                        <div class="layout horizontal wrap">
                            <div class="dynbox">
                                <dory-listbox selected="{{data.env}}" label="Environnements"
                                              code-labels="[[environments]]"></dory-listbox>
                            </div>
                            <div class="dynbox">
                                <paper-checkbox>Integration continue</paper-checkbox>
                            </div>

                            <paper-tags-input class="dynbox" label="Software" items='["Oracle 10"]'
                                              maxLength="10"></paper-tags-input>

                            <dory-sam-dyn-list class="dynbox" title="Urls" list="{{data.uris}}"
                                               button-label="Ajouter une Url"
                                               label-item="URI"
                                               placeholder="http://"></dory-sam-dyn-list>


                            <dory-sam-editor-servers class="dynbox"
                                                     servers="{{data.servers}}"></dory-sam-editor-servers>

                            <dory-sam-dyn-list class="dynbox" title="Databases" list="{{data.databases}}"
                                               button-label="Ajouter une bdd"
                                               label-item="Bdd"></dory-sam-dyn-list>

                            <dory-sam-dyn-list class="dynbox" title="Vips" list="{{data.vips}}"
                                               button-label="Ajouter un vip"
                                               label-item="Vip"></dory-sam-dyn-list>

                        </div>
                    </form>
                </air-cruddy-elasticsearch>
            </div>
            <div class="card-actions">
                <paper-button on-tap="_doValidate">Validate</paper-button>
                <paper-button on-tap="_doSubmit">Submit</paper-button>
                <paper-button on-tap="_requestList">Back</paper-button>
                <paper-button on-tap="_create">Create</paper-button>
            </div>

        </paper-card>

    </template>

    <script>
        Polymer({

            is: 'dory-sam-editor',

            listeners: {
                'iron-form-element-register': '_registerElementPrint',
            },
            properties: {
                entityId: {
                    type: String
                },
                data: {
                    type: Object,
                    notify: true,
                    value: function() { return {}; }
                },
                environments: {
                    type: Array,
                    notify: true,
                    value: function () {
                        return [
                            {code: 'QUALIF', label: 'Qualification'},
                            {code: 'REC', label: 'Recette'},
                            {code: 'PROD', label: 'Production'}
                        ];
                    }
                },
            },

            validate: function () {
                return _doValidate();
            },

            _doValidate: function () {
                var isValid = this.$.form.validate();
                console.log('Form is valid : ', isValid);
            },

            _doSubmit: function () {
                document.getElementById('form').submit();
            },

            _registerElementPrint: function (e) {
//                var element = Polymer.dom(e).rootTarget;
//                console.log('register', element);
            },

            _requestList: function (e) {
                this.fire('dory-open-page', {page: 'list'})
            },

            _create: function() {
                this.$.cruddy.data = this.data;
//                this.$.cruddy.data = {id:'monid', ent1: this.data.app, ent2:'val2'};
                this.$.cruddy.create();
            }

        });
    </script>
</dom-module>
